# 9.0 Data Manipulation

Name:

Date:

------------------------------------------------------------------------

We will start with a fresh, clean environment. The code chunk below clears your environment if you want to reset your work in interactive mode. Or use the broom button on the top right corner.

```{r}
rm(list = ls())
```

## 1. Loading packages and data

Today we will learn about data manipulation using the "split-apply-combine" strategy. This is really helpful because you can organize big datasets into more organized pieces and then put it back together.

Load the necessary packages:

```{r}
library(tidyverse)
library(palmerpenguins)
```

Load the penguins data:

```{r}
penguins = penguins
```

---

## 2. Grouping and counting with `group_by()` and `tally()`

For categorical data, it can be helpful to count members of a group. We can do this by combining `group_by()` and `tally()`.

Count the number of penguins of each sex:

```{r}
penguins %>%
  group_by(sex) %>%
  tally()
```

Currently we have 11 NA penguins included. We should remove these and create a clean table:

```{r}
clean_penguins <- penguins %>%
  group_by(sex) %>%
  filter(!is.na(sex)) %>%
  tally()

clean_penguins
```

---

## 3. Summarizing data with `group_by()` and `summarize()`

We can also use `group_by()` with `summarize()`. The main difference is that the non-grouping and non-output columns are removed.

Summarize the average bill length (in mm) by sex:

```{r}
bill_df <- penguins %>%
  group_by(sex) %>%
  filter(!is.na(sex)) %>%
  summarize(
    mean_bill_length = mean(bill_length_mm, na.rm = TRUE)
  )

bill_df
```

**Practice**: Summarize the average flipper length by species.

```{r}


```

---

## 4. Saving data to a file

You can save results to a file using the `write_csv()` function. This can be useful for later applications.

Save `bill_df` as a .csv file in our data directory:

```{r}
write_csv(bill_df, "data/bill_df.csv")
```

---

## 5. Using `count()` and `arrange()`

The `count()` function can be very helpful since it combines `group_by()` and `tally()` together.

The `arrange()` function sorts the data: - To sort by ascending numbers: `arrange(n)` - To sort by descending numbers: `arrange(desc(n))`

Count distinct number of penguin species in ascending order:

```{r}
penguin_counts <- penguins %>%
  count(species) %>%
  arrange(n)

penguin_counts
```

Count distinct number of penguin species in descending order:

```{r}
penguin_counts_desc <- penguins %>%
  count(species) %>%
  arrange(desc(n))

penguin_counts_desc
```

**Practice**: Count the number of penguins by island and arrange in descending order.

```{r}


```

---0

## 6. Using the `%in%` operator

Sometimes we only want to include specific values. The `%in%` operator is very helpful! This works similarly to OR statements.

Extract data specifying which species to keep: Adelie and Chinstrap:

```{r}
penguins_reduced <- penguins %>%
  filter(species %in% c("Adelie", "Chinstrap"))
```

This will create the same result as using multiple OR statements:

```{r}
penguins_reduced_same <- penguins %>%
  filter(species == "Adelie" | species == "Chinstrap")
```

**Practice**: Filter penguins to include only those from "Biscoe" and "Dream" islands.

```{r}


```

---

## 7. Applying concepts with the clinical dataframe

Let's try these functions with the `clinical` dataframe!

Load the clinical data:

```{r}
clinical <- read_csv("data/clinical.csv")
```

Count the number of each AJCC pathological stage and remove the NAs:

```{r}
clinical %>%
  group_by(ajcc_pathologic_stage) %>%
  filter(!is.na(ajcc_pathologic_stage)) %>%
  tally()
```

**Practice**: Count the number of patients by gender and remove NAs.

```{r}


```

---

## 8. Advanced summarizing with clinical data

Summarize the average age at diagnosis (in days) by tissue or organ of origin:

```{r}
age_tissue_df <- clinical %>%
  group_by(tissue_or_organ_of_origin) %>%
  filter(!is.na(tissue_or_organ_of_origin)) %>%
  summarize(
    mean_age = mean(age_at_diagnosis, na.rm = TRUE)
  )

age_tissue_df
```

It can be difficult to tell how old someone is in days. Let's add a new column to convert to years:

```{r}
age_tissue_years_df <- age_tissue_df %>%
  mutate(mean_age_years = mean_age / 365)

age_tissue_years_df
```

Save the new dataframe as a CSV file:

```{r}
write_csv(age_tissue_years_df, "data/age_tissue_years_df.csv")
```

**Practice**: Summarize the average pack years smoked by gender.

```{r}


```

---

## 9. More practice with `count()` and `arrange()`

Count distinct number of tissues or organs of origin in ascending order:

```{r}
tissue_organ_counts <- clinical %>%
  count(tissue_or_organ_of_origin) %>%
  arrange(n)

tissue_organ_counts
```

**Practice**: Count the number of patients by race and arrange in descending order.

```{r}


```


