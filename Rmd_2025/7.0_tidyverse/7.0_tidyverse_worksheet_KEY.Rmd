# 7.0 Tidyverse

First, we will start with a fresh, clean environment. The code chunk below clears your environment if you want to reset your work in interactive mode. Or use the broom button on the top right corner.

```{r}
rm(list = ls())
```

## Tidyverse

Today we will start using the tidyverse package. Tidyverse is one of the most commonly used R packages and actually contains many packages!

![Image source: <https://ajsmit.github.io/Intro_R_Official/tidy.html>](img/tidy_workflow.png){width="300"}

First, we will load the `tidyverse` library and `palmerpenguins` dataframe.

```{r}
library(tidyverse)
library(palmerpenguins)
penguins = penguins
```

Recall that we can use the `head()` function to look at the first few rows of our dataframe.

```{r}
head(penguins)
```

------------------------------------------------------------------------

## Selecting columns

We can extract columns using `select()` like this: `variable <- select(dataframe, column_name)`

Let's select three columns from the `penguins` dataframe using `select()`: `flipper_length_mm`, `body_mass_g`, and `year`.

```{r}
sel_columns <- select(penguins, flipper_length_mm, body_mass_g, year)

```

To select a range of columns, we can use the colon `:`, just like for vectors.

Select the columns from `bill_length_mm` to `body_mass_g`.

```{r}
sel_columns2 <- select(penguins, bill_length_mm : body_mass_g)

```

------------------------------------------------------------------------

## Helper functions

We can also use helper functions to select multiple columns:

-   `starts_with()` : starts with a prefix
-   `ends_with()` : ends with a prefix
-   `contains()` : contains a literal string
-   `matches()` : matches a regular expression
-   `num_range()` : a numerical range
-   `one_of()` : variables in character vector
-   `everything()` : all variables

Use the `ends_with()` function to select columns containing mm.

```{r}
sel_columns3 <- select(penguins, ends_with("mm"))

```

Use the `contains()` function to select columns containing the word length

```{r}
sel_columns4 <- select(penguins, contains("length"))
```

**Practice**: Use a helper function to select columns containing bill

```{r}
sel_columns_5 <- select(penguins, contains("bill"))
```

------------------------------------------------------------------------

You can also combine many conditions together using `|` and `&` symbols!

Here is an example to select columns that contains "Species" OR ends with "mm".

```{r}
sel_columns_lots <- select(penguins, contains("Species") | ends_with("mm"))
```

------------------------------------------------------------------------

## Keep rows using `filter()`.

We can extract rows with the `filter()` function. We can use comparison operators to help us filter rows based on a selection.

Recall the comparison operators are:

-   `>` - greater than
-   `<` - less than
-   `==` - equals to
-   `>=` greater than or equals to
-   `<=` less than or equals to

As an example, you might only be interested in penguins that were recording in the year 2007. You can do subset the data like this:

1.  Identify the column the contains the data you want to filter
2.  Use a comparison operator to select the condition you are interested in
3.  Use the `filter` function to extract rows.

```{r}
sel_rows <- filter(penguins, year == 2007)
```

**Practice**: Keep rows of penguins that have a bill length of 40 mm.

```{r}

```

------------------------------------------------------------------------

## Plotting filtered dataframes

Recall that we can make a plot by specifying the columns that we want in the `x` and `y` arguments.

```{r}
## Access the bill_length_mm and flipper length_mm columns
bill_length = penguins$bill_length_mm
flipper_length = penguins$flipper_length_mm

## Plot the two columns as a scatter plot.
ggplot()  + aes(x = bill_length, y = flipper_length) + geom_point()
```

Now we can put dataframes in the plotting code and specify the columns we want directly as `x` and `y`.

`ggplot(data=penguins) + aes(x = bill_length_mm, y = flipper_length_mm) + geom_point()`

Note the `data=penguins`, `x=bill_length_mm`, and `y=flipper_length_mm`.

```{r}
ggplot(data=penguins) + aes(x = bill_length_mm, y = flipper_length_mm) + geom_point()
```

If we filter the dataframe first and then use it as an input for `data=`, we can see how the plot changes.

Filter the `penguins` to have only penguins with a bill length of less than 50mm.

```{r}

## Filter the penguins dataframe
filtered_penguins = filter(penguins, bill_length_mm < 50)

## Plot the data from the filted dataframe.
ggplot(data=filtered_penguins) + aes(x = bill_length_mm, y = flipper_length_mm) + geom_point()
```

------------------------------------------------------------------------

## Combining commands

Keep in mind that there are many ways to accomplish the same goal in R!

Intermediate variables can be very useful if you want to save or keep "intermediate" steps before the final product

Let's try the following:

Here is an example to select columns that contains "Species" OR ends with "mm".

1.  Select the columns that contains "Species" OR ends with "mm".
2.  Keep the rows that only has Adelie penguins.
3.  Keep penguins that only have a bill length of over 20mm.

```{r}
selected_columns <- select(penguins, contains("Species") | ends_with("mm"))

# keep only "Adelie" penguin data
filtered_rows <- filter(selected_columns, species == "Adelie")

# keep Adelie penguins with bill_length_mm over 20mm
filtered_rows2 <- filter(filtered_rows, bill_length_mm > 20)
```

Alternatively, you can combine all the steps in a nested function:

```{r}
nested_dataframe <- filter(filter(select(penguins, contains("Species") | ends_with("mm")), species == "Adelie"), bill_length_mm > 20)
```

However, the order of `select()` and `filter()` do matter.

Try this example:

1.  Select the all the columns that contain millimeter measurements.
2.  Keep only the penguins from `Dream` island.

```{r}

selected_columns = select(penguins, ends_with("mm"))

filter(selected_columns, island == "Dream")

```
