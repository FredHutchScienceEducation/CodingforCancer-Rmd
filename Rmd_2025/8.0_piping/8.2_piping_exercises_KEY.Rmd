# 8.2 Piping Exercises

In this exercise, we will go back to the Mr. Trash Wheel Exercises but use piping.

![Check out Mr. Trash Wheel at: <https://www.mrtrashwheel.com>](https://media.wbur.org/wp/2019/04/0416_trashwheel01.jpg){width="300"}

As always, we will start with a fresh, clean environment. The code chunk below clears your environment if you want to reset your work in interactive mode. Or use the broom button on the top right corner.

```{r}
rm(list = ls())
```

------------------------------------------------------------------------

## Load the dataset

Run this code chunk below to download the dataset and extract the dataframes into its own object. After running this code chunk, you should see the downloaded dataframe(s) in the Environment pane.

```{r}
#### Do not alter the code below. This is a function that will download your dataset. 

# install.packages("tidytuesdayR") - uncomment and run this code if the library is not found
library(tidytuesdayR)
trashwheel <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2024/2024-03-05/trashwheel.csv')

```

------------------------------------------------------------------------

## Explore the dataframe

1.  Let's view the `trashwheel` data frame you just downloaded using the `View()` function.

    ```{r}

    ```

2.  You can assess the size of the data frame using the function `dim(dataframe)`.

    ```{r}

    ```

    \*\*Answer: Number of rows = \_\_\_\*\*

    \*\*Answer: Number of columns = \_\_\_\*\*

3.  You can preview the first few rows using the function `head(dataframe)`.

    ```{r}

    ```

4.  Use the `colnames()` function on the `trashwheel` dataframe.

    ```{r}

    ```

------------------------------------------------------------------------

## Selecting columns

1.  Use the `select()` function to select the `Name`, `Weight` and `Year` columns from the `trashwheel` dataframe. Assign the result to an object called `selected_cols`.

    ```{r}

    ```

2.  Use the `select()` function to select columns from `PlasticBottles` to `SportsBalls`. Assign the result to an object called `trash_types`.

    ```{r}

    ```

3.  Select all columns that end with "s" (like PlasticBottles, GlassBottles, etc.).

    ```{r}

    ```

4.  Select all columns that contain the word "Plastic".

    ```{r}

    ```

5.  Select all columns that start with the letter "P".

    ```{r}

    ```

6.  Select columns that either contain "Bottle" OR end with "s".

    ```{r}

    ```

------------------------------------------------------------------------

## Filtering rows

1.  Use the `filter()` function to keep only rows where the `Year` is equal to 2020. Assign the result to an object called `year_2020`.

    ```{r}

    ```

2.  Use the `filter()` function to keep only rows where the `Weight` is greater than 3 tons. Hint: the values in the `Weight` column are measured in tons.

    ```{r}

    ```

3.  Keep only rows where the `Name` is equal to "Mister Trash Wheel".

    ```{r}

    ```

4.  Keep only rows where `PlasticBottles` is greater than 1000.

    ```{r}

    ```

5.  Keep only rows where `CigaretteButts` is less than or equal to 10000.

    ```{r}

    ```

6.  Keep only rows where `Year` is 2019 AND `Weight` is greater than 2. Use the `&` symbol to combine conditions.

    ```{r}

    ```

------------------------------------------------------------------------

## Combining `select()` and `filter()` using pipes `%>%`

1.  First, use `select()` to choose the columns `Name`, `Year`, `Weight`, and `PlasticBottles`. Then use `filter()` to keep only rows from 2021. Do this using piping `%>%`.

    ```{r}


    ```

    ```{r}

    ```

2.  Select the columns `Name`, `Month`, `Year`, and `CigaretteButts`. Then filter to keep only data from "Mister Trash Wheel". Do this using piping `%>%`.

    ```{r}


    ```

3.  Select columns that contain "Plastic" OR end with "s", then filter to keep only rows where `Weight` is greater than 1 and `Year` is greater than or equal to 2018. Do this using piping `%>%`.

    ```{r}

    ```

------------------------------------------------------------------------

## Challenge questions

1.  **Multi-step piping practice**: Use piping to select only the columns `Name`, `Year`, `Month`, `Weight`, and all columns that contain "Bottle". Then filter to keep only data from 2019-2021 where the weight is between 1 and 4 tons (inclusive). How many rows remain in your final dataset?

    ```{r}
    # Solution
    result1 <- trashwheel %>%
      select(Name, Year, Month, Weight, contains("Bottle")) %>%
      filter(Year >= 2019 & Year <= 2021,
             Weight >= 1 & Weight <= 4)

    nrow(result1)  # To see number of rows
    ```

2.  **Advanced filtering with column selection**: Create a pipeline that first selects the `Name` column and all columns ending with "s", then filters to keep only rows from "Professor Trash Wheel" OR "Captain Trash Wheel" where `CigaretteButts` is greater than 5000. The pipe the filtered dataframe to `head(n=10)` to display the first 10 rows of your result.

    ```{r}
    # Solution
    result2 <- trashwheel %>%
      select(Name, ends_with("s")) %>%
      filter((Name == "Professor Trash Wheel" | Name == "Captain Trash Wheel"),
             CigaretteButts > 5000) %>%
      head(n = 10)

    result2
    ```

3.  **Conditional selection and filtering**: Use piping to select `Name`, `Date`, `Weight`, and any columns that start with "P". Then filter to keep only collections where `Weight` is above the median weight AND `PlasticBottles` is above 500. What is the total number of plastic bottles collected in these high-weight, high-plastic collections? (Hint: Use `sum()` on the `PlasticBottles` column)

    ```{r}
    # Solution
    result3 <- trashwheel %>%
      select(Name, Date, Weight, starts_with("P")) %>%
      filter(Weight > median(Weight, na.rm = TRUE), PlasticBottles > 500)

    sum(result3$PlasticBottles, na.rm = TRUE)  # Total plastic bottles
    ```

4.  **Complex filtering with multiple conditions**: Create a pipeline that selects `Name`, `Year`, `Month`, `Weight`, `PlasticBottles`, and `CigaretteButts`. Then filter for collections that meet ALL of these criteria:

    -   Year is 2020 or later
    -   Month is between 4 and 9 (spring/summer months)
    -   Either `PlasticBottles` \> 800 OR `CigaretteButts` \> 8000

    How many collections meet these criteria, and which trash wheel appears most frequently in your filtered data?

    ```{r}
    # Solution
    result4 <- trashwheel %>%
      select(Name, Year, Month, Weight, PlasticBottles, CigaretteButts) %>%
      filter(Year >= 2020,
             Month >= 4 & Month <= 9,
             PlasticBottles > 800 | CigaretteButts > 8000)

    nrow(result4)  # Number of collections
    table(result4$Name)  # Frequency of each trash wheel
    ```

5.  **Piping with helper functions**: Use `select()` with helper functions to choose `Name`, `Date`, `Weight` and all columns that either contain "Ball" or contain "Bottle". Then pipe to the `slice_max(Weight, n = 20)` function to keep only the top 20 collections by weight.

    Which trash wheel collected the heaviest load, and what was the weight?

    ```{r}
    # Solution
    result5 <- trashwheel %>%
      select(Name, Date, Weight, contains("Ball") | contains("Bottle")) %>%
      slice_max(Weight, n = 20)

    result5[1, ]  # First row shows heaviest collection
    # Or to just see the name and weight:
    result5 %>% select(Name, Weight) %>% head(1)
    ```
