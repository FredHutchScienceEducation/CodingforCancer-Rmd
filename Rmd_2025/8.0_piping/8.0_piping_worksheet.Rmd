# 8.0 Piping

Name:

Date:

------------------------------------------------------------------------

We will start with a fresh, clean environment. The code chunk below clears your environment if you want to reset your work in interactive mode. Or use the broom button on the top right corner.

```{r}
rm(list = ls())
```

## 1. Loading packages and data

Today we will learn about piping, which is part of the tidyverse package! Piping helps streamline workflows by using the output of one command as the input for the next command.

Load the necessary packages:

```{r}
library(tidyverse)
library(palmerpenguins)
```

Load the penguins data:

```{r}
penguins = penguins
```

------------------------------------------------------------------------

## 2. Introduction to piping

The piping operator is `%>%`. It takes the result from the left side and passes it to the function on the right side.

Instead of writing nested functions like this:

```         
filter(select(penguins, species, sex, year), sex == "female")
```

We can use piping to make it more readable:

```         
penguins %>%
  select(species, sex, year) %>%
  filter(sex == "female")
```

Let's try our first pipe! Use piping to create a dataframe containing only female penguins and select the columns `year`, `bill_length_mm`, and `island`.

```{r}
piped <- penguins %>%
  filter(sex == "female") %>%
  select(year, bill_length_mm, island)
```

Now you try! Use piping to create a dataframe containing only penguins with `flipper_length_mm` over 190mm and select the columns `species`, `sex`, and `year`.

```{r}


```

------------------------------------------------------------------------

## 3. Adding new columns with `mutate()`

We can add new columns to our dataframe using the `mutate()` function. This is especially powerful when combined with piping.

Use piping to create a new column called `bill_length_cm` where the `bill_length_mm` is converted to centimeters (divide by 10).

```{r}
bill_cm_df <- penguins %>%
  mutate(bill_length_cm = bill_length_mm / 10)
```

**Practice**: Use piping to create a new column called `mass_kg` where the `body_mass_g` is converted to kilograms (divide by 1000).

```{r}


```

------------------------------------------------------------------------

## 4. Working with a new dataset

Now we'll work with a clinical dataset to practice our piping skills with a larger dataframe.

First, let's read in the `clinical` dataset:

```{r}
clinical <- read_csv("data/clinical.csv")
```

Let's explore this new dataframe using functions we've learned:

```{r}
# Check the dimensions
dim(clinical)
```

```{r}
# Look at the column names
colnames(clinical)
```

```{r}
# Look at the first few rows
head(clinical)
```

------------------------------------------------------------------------

## 5. Exploring data types and missing values

We can check the data type of specific columns using the `class()` function:

```{r}
# Check the data type of year_of_birth
class(clinical$year_of_birth)
```

```{r}
# Check the data type of Tobacco.smoking.history
class(clinical$Tobacco.smoking.history)
```

We can also check for missing values (NA) in our data:

```{r}
# Check if there are any NA values in sample_type
is.na(clinical$sample_type)
```

```{r}
# Count the total number of NA values in pack_years_smoked
sum(is.na(clinical$pack_years_smoked))
```

------------------------------------------------------------------------

## 6. Practice with piping and the clinical dataframe

Let's create a subset of the clinical dataframe using piping! Create a new dataframe called `smoke_clinical` that includes only these 5 columns:

-   `primary_diagnosis`
-   `Vital.status`
-   `Tobacco.smoking.history`
-   `pack_years_smoked`
-   `cigarettes_per_day`

```{r}
smoke_clinical <- clinical %>%
  select(primary_diagnosis, Vital.status, Tobacco.smoking.history,
         pack_years_smoked, cigarettes_per_day)
```

**Practice**: Create a new dataframe called `filtered_clinical` that: 1. Filters to keep only patients with `Vital.status` equal to "Alive" 2. Selects the columns `primary_diagnosis`, `age_at_diagnosis`, and `Vital.status`

```{r}


```

**Practice**: Create a new dataframe that:

1.  Filters to keep only patients who have `pack_years_smoked` greater than 10
2.  Creates a new column called `heavy_smoker` that equals "Yes" for all these patients
3.  Selects the columns `primary_diagnosis`, `pack_years_smoked`, and `heavy_smoker`

```{r}


```
